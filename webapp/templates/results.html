<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Results - Azure Resource Discovery</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .results-header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 2rem 0;
        }
        .cost-card {
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: none;
        }
        .savings-positive { color: #28a745; }
        .savings-negative { color: #dc3545; }
        .resource-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
    </style>
</head>
<body class="bg-light">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #0078d4;">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-cloud me-2"></i>
                Azure Resource Discovery
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">
                    <i class="fas fa-plus me-1"></i>
                    New Analysis
                </a>
            </div>
        </div>
    </nav>

    <!-- Results Header -->
    <section class="results-header">
        <div class="container text-center">
            <h1 class="display-5 mb-3">
                <i class="fas fa-chart-line me-3"></i>
                Analysis Results
            </h1>
            <p class="lead mb-0">
                Generated on {{ result.completed_at[:19] | replace('T', ' ') }}
            </p>
        </div>
    </section>

    <div class="container my-5">
        <!-- Cost Summary -->
        <div class="row mb-5">
            <div class="col-12">
                <h2 class="mb-4">
                    <i class="fas fa-dollar-sign me-2"></i>
                    Cost Comparison Summary
                </h2>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="card cost-card h-100">
                    <div class="card-body text-center">
                        <i class="fab fa-microsoft fa-2x text-primary mb-3"></i>
                        <h5>Azure (List Price)</h5>
                        <h3 class="text-primary">${{ "%.2f"|format(result.summary.total_azure_cost) }}</h3>
                        <small class="text-muted">per month</small>
                    </div>
                </div>
            </div>

            {% if result.summary.macc_discount > 0 %}
            <div class="col-md-3 mb-3">
                <div class="card cost-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-percentage fa-2x text-warning mb-3"></i>
                        <h5>MACC Discount</h5>
                        <h3 class="text-warning">{{ result.summary.macc_discount }}%</h3>
                        <small class="text-muted">-${{ "%.2f"|format(result.summary.total_azure_cost - result.summary.macc_adjusted_cost) }}/month</small>
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-3">
                <div class="card cost-card h-100">
                    <div class="card-body text-center">
                        <i class="fab fa-microsoft fa-2x text-info mb-3"></i>
                        <h5>Azure (Your Cost)</h5>
                        <h3 class="text-info">${{ "%.2f"|format(result.summary.macc_adjusted_cost) }}</h3>
                        <small class="text-muted">per month</small>
                    </div>
                </div>
            </div>
            {% endif %}

            <div class="col-md-3 mb-3">
                <div class="card cost-card h-100">
                    <div class="card-body text-center">
                        <i class="fab fa-aws fa-2x text-warning mb-3"></i>
                        <h5>AWS Equivalent</h5>
                        <h3 class="text-warning">${{ "%.2f"|format(result.summary.total_aws_cost) }}</h3>
                        <small class="text-muted">per month</small>
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-3">
                <div class="card cost-card h-100">
                    <div class="card-body text-center">
                        {% if result.summary.potential_savings > 0 %}
                            <i class="fas fa-arrow-down fa-2x text-success mb-3"></i>
                            <h5>Potential Savings</h5>
                            <h3 class="savings-positive">${{ "%.2f"|format(result.summary.potential_savings) }}</h3>
                            <small class="text-muted">{{ "%.1f"|format(result.summary.savings_percent) }}% savings</small>
                        {% else %}
                            <i class="fas fa-arrow-up fa-2x text-danger mb-3"></i>
                            <h5>Additional Cost</h5>
                            <h3 class="savings-negative">${{ "%.2f"|format(-result.summary.potential_savings) }}</h3>
                            <small class="text-muted">{{ "%.1f"|format(-result.summary.savings_percent) }}% increase</small>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Resources Summary -->
        <div class="row mb-5">
            <div class="col-12">
                <h2 class="mb-4">
                    <i class="fas fa-server me-2"></i>
                    Resource Summary
                </h2>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Discovered Resources</h5>
                        <div class="row text-center">
                            <div class="col-4 col-md-2 mb-3">
                                <i class="fas fa-desktop fa-2x text-primary mb-2"></i>
                                <div class="small">Virtual Machines</div>
                                <div class="h4">{{ result.resources.virtual_machines|length }}</div>
                            </div>
                            <div class="col-4 col-md-2 mb-3">
                                <i class="fas fa-database fa-2x text-success mb-2"></i>
                                <div class="small">Storage Accounts</div>
                                <div class="h4">{{ result.resources.storage_accounts|length }}</div>
                            </div>
                            <div class="col-4 col-md-2 mb-3">
                                <i class="fas fa-table fa-2x text-info mb-2"></i>
                                <div class="small">SQL Databases</div>
                                <div class="h4">{{ result.resources.sql_databases|length }}</div>
                            </div>
                            <div class="col-4 col-md-2 mb-3">
                                <i class="fas fa-globe fa-2x text-warning mb-2"></i>
                                <div class="small">App Services</div>
                                <div class="h4">{{ result.resources.app_services|length }}</div>
                            </div>
                            <div class="col-4 col-md-2 mb-3">
                                <i class="fas fa-cogs fa-2x text-secondary mb-2"></i>
                                <div class="small">Other Resources</div>
                                <div class="h4">{{ result.resources.other_resources|length }}</div>
                            </div>
                            <div class="col-4 col-md-2 mb-3">
                                <i class="fas fa-layer-group fa-2x text-dark mb-2"></i>
                                <div class="small">Total</div>
                                <div class="h4">{{ (result.resources.virtual_machines|length + result.resources.storage_accounts|length + result.resources.sql_databases|length + result.resources.app_services|length + result.resources.other_resources|length) }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column justify-content-center text-center">
                        <h5 class="card-title">Download Report</h5>
                        <p class="card-text">Get a detailed JSON report of your analysis</p>
                        <a href="/api/results/{{ session_id }}/download" class="btn btn-outline-primary">
                            <i class="fas fa-download me-2"></i>
                            Download JSON
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Resource Analysis -->
        {% if result.aws_costs %}
        <div class="row mb-5">
            <div class="col-12">
                <h2 class="mb-4">
                    <i class="fas fa-exchange-alt me-2"></i>
                    Resource Migration Analysis
                </h2>
            </div>
        </div>

        {% for service_type, costs in result.aws_costs.items() %}
        {% if costs %}
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    {% if service_type == 'virtual_machines' %}
                        <i class="fas fa-desktop me-2"></i>Virtual Machines â†’ EC2 Instances
                    {% elif service_type == 'app_services' %}
                        <i class="fas fa-globe me-2"></i>App Services â†’ Lambda + API Gateway
                    {% elif service_type == 'storage_accounts' %}
                        <i class="fas fa-database me-2"></i>Storage Accounts â†’ S3
                    {% elif service_type == 'sql_databases' %}
                        <i class="fas fa-table me-2"></i>SQL Databases â†’ RDS
                    {% else %}
                        <i class="fas fa-cogs me-2"></i>{{ service_type.replace('_', ' ').title() }}
                    {% endif %}
                </h5>
            </div>
            <div class="card-body">
                {% if costs is mapping %}
                    <div class="row">
                        <div class="col-md-4">
                            <strong>Azure Cost:</strong> ${{ "%.2f"|format(costs.azure_monthly_cost or 0) }}/month
                        </div>
                        <div class="col-md-4">
                            <strong>AWS Cost:</strong> ${{ "%.2f"|format(costs.aws_monthly_cost or 0) }}/month
                        </div>
                        <div class="col-md-4">
                            {% set savings = (costs.azure_monthly_cost or 0) - (costs.aws_monthly_cost or 0) %}
                            {% if savings > 0 %}
                                <strong class="savings-positive">Savings: ${{ "%.2f"|format(savings) }}/month</strong>
                            {% else %}
                                <strong class="savings-negative">Additional: ${{ "%.2f"|format(-savings) }}/month</strong>
                            {% endif %}
                        </div>
                    </div>
                {% else %}
                    {% for item in costs %}
                    <div class="mb-3 p-3 border rounded">
                        <div class="row">
                            <div class="col-md-3">
                                <strong>{{ item.name or 'Unnamed Resource' }}</strong>
                                {% if item.size %}
                                <br><span class="badge bg-info resource-badge">{{ item.size }}</span>
                                {% endif %}
                            </div>
                            <div class="col-md-3">
                                Azure: ${{ "%.2f"|format(item.azure_monthly_cost or 0) }}/month
                            </div>
                            <div class="col-md-3">
                                AWS: ${{ "%.2f"|format(item.aws_monthly_cost or 0) }}/month
                            </div>
                            <div class="col-md-3">
                                {% set savings = (item.azure_monthly_cost or 0) - (item.aws_monthly_cost or 0) %}
                                {% if savings > 0 %}
                                    <span class="savings-positive">-${{ "%.2f"|format(savings) }}</span>
                                {% else %}
                                    <span class="savings-negative">+${{ "%.2f"|format(-savings) }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
        {% endif %}
        {% endfor %}
        {% endif %}

        <!-- Important Notes -->
        <div class="row">
            <div class="col-12">
                <div class="card border-warning">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Important Notes
                        </h5>
                    </div>
                    <div class="card-body">
                        <ul class="mb-0">
                            <li>These are <strong>rough estimates</strong> for planning purposes</li>
                            <li>Actual costs may vary significantly based on usage patterns, region, and specific configurations</li>
                            <li>Consider <strong>Reserved Instances</strong> for 25-60% additional savings</li>
                            <li>Factor in <strong>migration costs</strong> and operational complexity</li>
                            <li>Use official AWS Pricing Calculator for detailed estimates</li>
                            <li>Data transfer costs are not included in these estimates</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0">
                <i class="fab fa-microsoft me-2"></i>
                Azure Resource Discovery Tool â€¢ Analysis ID: {{ session_id[:8] }}
            </p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>